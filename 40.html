<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Chapitre 7 - Les consonnes nasales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        :root {
            --font-sm: clamp(0.75rem, 2vmin, 0.875rem);
            --font-base: clamp(0.875rem, 2.5vmin, 1rem);
            --font-lg: clamp(1rem, 3vmin, 1.25rem);
            --font-xl: clamp(1.125rem, 4vmin, 1.5rem);
            --font-title: clamp(1.5rem, 5vmin, 2rem);
            --font-display: clamp(5rem, 20vmin, 8rem);
            --font-char-btn: clamp(4rem, 15vmin, 5rem);
            --font-jamo-key: clamp(1rem, 4vmin, 1.1rem);
            --font-jamo-dropzone: clamp(2rem, 8vmin, 2.25rem);
            --padding-sm: clamp(0.5rem, 2vmin, 0.75rem);
            --padding-md: clamp(0.75rem, 3vmin, 1.5rem);
            --padding-lg: clamp(1rem, 4vmin, 2.5rem);
        }
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
        }
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            display: flex; align-items: center; justify-content: center;
            min-height: 100vh; padding: 1rem; background-color: #f3f4f6;
        }

        /* --- Layout --- */
        .course-wrapper { width: 100%; max-width: 600px; }
        .course-container {
            width: 100%; position: relative; aspect-ratio: 1 / 1;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            border-radius: 0.75rem; overflow: hidden; background-color: white;
        }
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: space-between;
            opacity: 0; visibility: hidden; transition: opacity 0.4s ease-in-out;
            background-color: white; padding: var(--padding-lg); box-sizing: border-box;
        }
        .page.active { opacity: 1; visibility: visible; }
        .page-content {
            flex-grow: 1; overflow: hidden; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        
        /* --- Mobile Responsive --- */
        @media (max-width: 600px) {
            body { padding: 0; height: 100vh; max-height: -webkit-fill-available; }
            .course-wrapper { height: 100%; max-width: 100%; }
            .course-container { aspect-ratio: auto; height: 100%; border-radius: 0; }
            .page { padding: 1.5rem 1rem; border-radius: 0; }
        }

        /* --- Common Elements --- */
        .title-text { font-size: var(--font-title); }
        .lesson-text { font-size: var(--font-lg); color: #4b5563; line-height: 1.6; }
        .nav-button { padding: var(--padding-sm) var(--padding-md); border-radius: 0.5rem; font-weight: 600; font-size: var(--font-base); transition: background-color 0.2s; }
        .char-button {
            font-size: var(--font-char-btn); font-weight: 700; font-family: 'Noto Sans KR', sans-serif;
            background-color: #eff6ff; border: 2px solid #93c5fd;
            border-radius: 1rem; padding: var(--padding-sm) var(--padding-md);
            cursor: pointer; transition: background-color 0.2s, transform 0.1s;
            line-height: 1.1;
        }
        .char-button:hover { background-color: #dbeafe; }
        .char-button:active { transform: scale(0.95); }

        /* Combination Page */
        .combination-content .char-button { font-size: clamp(2.5rem, 10vw, 3.5rem); padding: clamp(0.5rem, 2.5vmin, 1rem); }
        .combination-content .symbol-text { font-size: clamp(2rem, 8vw, 3rem); font-weight: 700; color: #9ca3af; }

        /* --- Quiz --- */
        .quiz-question { font-weight: 600; font-size: var(--font-lg); color: #1f2937; margin-bottom: 1rem; }
        .audio-button { background: none; border: none; cursor: pointer; }
        .audio-icon { width: clamp(2.5rem, 8vmin, 3rem); height: clamp(2.5rem, 8vmin, 3rem); color: #6b7280; transition: color 0.2s; }
        .audio-button:hover .audio-icon { color: #1d4ed8; }
        .quiz-option {
            display: inline-block; padding: var(--padding-sm) var(--padding-md);
            border: 2px solid #d1d5db; border-radius: 0.5rem; margin: 0.25rem; cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            font-family: 'Noto Sans KR', sans-serif; font-size: var(--font-xl); min-width: 60px;
        }
        .quiz-option:hover { background-color: #f3f4f6; }
        .quiz-option.selected { background-color: #e0e7ff; border-color: #a5b4fc; }
        .quiz-option.correct { background-color: #dcfce7 !important; border-color: #4ade80 !important; }
        .quiz-option.incorrect { background-color: #fee2e2 !important; border-color: #f87171 !important; }
        .quiz-option input { display: none; }
        .feedback-area { text-align: right; min-height: 52px; display: flex; gap: 0.5rem; justify-content: flex-end; align-items: center;}
    </style>
</head>
<body>

    <div class="course-wrapper">
        <div class="course-container">
            <!-- Content will be generated by JavaScript -->
        </div>
    </div>

    <script>
        let currentPageId = 'page-0';

        const sounds = {
            'n': { file: 'https://static.wixstatic.com/mp3/699687_4814975f22564446b6ed84b41c0555ba.mp3' },
            'd': { file: 'https://static.wixstatic.com/mp3/699687_87a9f8b74219436d93beb9b795320bc7.mp3' },
            'a': { file: 'https://static.wixstatic.com/mp3/699687_23c826488a4041f488691d65bbecea21.mp3' },
            'na': { file: 'https://static.wixstatic.com/mp3/699687_f6f0eec6e902488688c2bd594a5168eb.mp3' },
            'm': { file: 'https://static.wixstatic.com/mp3/699687_2c549d3c1cfa418d8bca0494c1e19fa6.mp3' },
            'b': { file: 'https://static.wixstatic.com/mp3/699687_75717886fe7f4b1aacf95580bf551aa6.mp3' },
            'u': { file: 'https://static.wixstatic.com/mp3/699687_b11e5a88156d46a383099c42bfd4f814.mp3' },
            'j': { file: 'https://static.wixstatic.com/mp3/699687_5b225746266e4329ad05d50b82a6b6e9.mp3' },
            'mu': { file: 'https://static.wixstatic.com/mp3/699687_bd1cd5427a5949998cfbedd4150fdeb6.mp3' },
            'ng': { file: 'https://static.wixstatic.com/mp3/699687_74dea59f6fc7403cbe126b21ff3389e7.mp3' },
            's': { file: 'https://static.wixstatic.com/mp3/699687_88ce9d0e984d41989f3bd6c61cbc7219.mp3' },
            'go': { file: 'https://static.wixstatic.com/mp3/699687_ac1d798eeb3544cf8268ed0dee83869b.mp3' },
            'gong': { file: 'https://static.wixstatic.com/mp3/699687_8392306375964831bd7e254e283d7ab8.mp3' },
            'kk': { file: 'https://static.wixstatic.com/mp3/699687_11178917eb3143f8808c9738c908a8c2.mp3' },
            'tt': { file: 'https://static.wixstatic.com/mp3/699687_d1d7b6f646384330b8e83dcec2528b58.mp3' },
            'pp': { file: 'https://static.wixstatic.com/mp3/699687_784e5eca868942149549a2f4857656c9.mp3' },
            'ss': { file: 'https://static.wixstatic.com/mp3/699687_bb6330ca0bc24ffc857057df5c02cd9a.mp3' },
            'jj': { file: 'https://static.wixstatic.com/mp3/699687_45727056d58143228620e2d40afb3e7c.mp3' },
        };
        
        const quizData = [
            { id: 1, page: 12, type: 'mc', sound: 'm', answer: 'ㅁ', options: { 'ㄴ': 'ㄴ', 'ㅁ': 'ㅁ', 'ㅂ': 'ㅂ' } },
            { id: 2, page: 13, type: 'mc', sound: 'n', answer: 'ㄴ', options: { 'ㄱ': 'ㄱ', 'ㄴ': 'ㄴ', 'ㄷ': 'ㄷ' } },
            { id: 3, page: 14, type: 'mc', sound: 'ng', answer: 'ㅇ', options: { 'ㅇ': 'ㅇ', 'ㅎ': 'ㅎ' } },
            { id: 4, page: 15, type: 'mc', sound: 'j', answer: 'ㅈ', options: { 'ㄷ': 'ㄷ', 'ㅈ': 'ㅈ', 'ㅊ': 'ㅊ' } },
            { id: 5, page: 16, type: 'mc', sound: 'kk', answer: 'ㄲ', options: { 'ㄱ': 'ㄱ', 'ㅋ': 'ㅋ', 'ㄲ': 'ㄲ' } },
            { id: 6, page: 17, type: 'mc', sound: 's', answer: 'ㅅ', options: { 'ㅅ': 'ㅅ', 'ㅈ': 'ㅈ', 'ㅆ': 'ㅆ', 'ㅊ': 'ㅊ' } }
        ];

        function playSound(soundKey) {
            if (!sounds[soundKey]) return;
            Tone.start().then(() => {
                const player = new Tone.Player(sounds[soundKey].file).toDestination();
                player.autostart = true;
                player.onstop = () => player.dispose();
            }).catch(e => console.error("Audio could not start:", e));
        }

        function showPage(pageId) {
            const currentPage = document.getElementById(currentPageId);
            if (currentPage) currentPage.classList.remove('active');
            
            const nextPage = document.getElementById(pageId);
            if (nextPage) {
                nextPage.classList.add('active');
                currentPageId = pageId;
                if (pageId.startsWith('page-')) { 
                    const quizNumMatch = pageId.match(/page-(\d+)/);
                    if (quizNumMatch && quizData.some(q => q.page == quizNumMatch[1])) {
                        resetPageState(pageId);
                    }
                }
            }

            // [ADDED] PostMessage logic
            if (pageId === 'completion-page') {
                if (window.parent) {
                    try {
                        window.parent.postMessage({
                            type: 'lesson_complete'
                        }, '*');
                    } catch (e) {
                        console.error('postMessage failed:', e);
                    }
                }
            }
        }

        function resetPageState(pageId) {
            const pageElement = document.getElementById(pageId);
            if (!pageElement) return;

            const quizNav = pageElement.querySelector('[id$="-nav"]');
            if (quizNav && quizNav.dataset.initialHtml) {
                quizNav.innerHTML = quizNav.dataset.initialHtml;
                const quizDataEntry = quizData.find(q => `page-${q.page}` === pageId);
                if (quizDataEntry) {
                    const quizNum = quizDataEntry.id;
                    const newCheckButton = quizNav.querySelector('button[onclick^="check"]');
                    if (newCheckButton) {
                        newCheckButton.onclick = () => checkAnswer(quizNum);
                    }
                }
            }
            
            const options = pageElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                const radio = opt.querySelector('input');
                if (radio) { radio.checked = false; radio.disabled = false; }
            });
        }

        function checkAnswer(quizNum) {
            const data = quizData.find(q => q.id === quizNum);
            const selectedOption = document.querySelector(`input[name="q${quizNum}"]:checked`);
            const navEl = document.getElementById(`quiz-${quizNum}-nav`);
            const feedbackContainer = navEl.querySelector(`#quiz-${quizNum}-feedback`);
            
            if (!selectedOption) {
                feedbackContainer.innerHTML = `<p class="text-yellow-600 font-bold" style="font-size: var(--font-base);">Veuillez sélectionner une réponse.</p>`; // Smaller text
                setTimeout(() => { if(feedbackContainer) feedbackContainer.innerHTML = ''; }, 2000);
                return;
            }
            
            navEl.querySelector('button[onclick^="check"]').style.display = 'none';
            document.querySelectorAll(`input[name="q${quizNum}"]`).forEach(opt => {
                opt.disabled = true;
                opt.parentElement.style.cursor = 'default';
            });
            
            const isCorrect = selectedOption.value === data.answer;
            selectedOption.parentElement.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // [MODIFIED] More robust way to check for the last quiz
            const isLastQuiz = data.id === quizData[quizData.length - 1].id;
            const nextPageId = isLastQuiz ? 'completion-page' : `page-${data.page + 1}`;
            const buttonText = isLastQuiz ? 'Terminer' : 'Suivant &rarr;';

            if (isCorrect) {
                feedbackContainer.innerHTML = `<button onclick="showPage('${nextPageId}')" class="nav-button bg-green-600 text-white hover:bg-green-700">${buttonText}</button>`;
            } else {
                feedbackContainer.innerHTML = `<button onclick="resetQuiz(${quizNum})" class="nav-button bg-red-600 text-white hover:bg-red-700">Réessayer</button>`;
            }
        }
        
        function resetQuiz(quizNum) {
            const pageId = `page-${quizData.find(q => q.id === quizNum).page}`;
            resetPageState(pageId);
        }

        function createPages() {
            const container = document.querySelector('.course-container');
            // [MODIFIED] Fixed invalid </br> and </p> tags in h1
            let pagesHtml = `
                <div id="page-0" class="page active"> <div class="page-content text-center"> <h1 class="title-text font-bold text-gray-800">Chapitre 7<br>Les consonnes nasales<br> ㄴ / ㅁ / ㅇ</h1> <button onclick="showPage('page-1')" class="nav-button bg-blue-600 text-white hover:bg-blue-700 mt-8">Commencer</button> </div> <div></div> </div>
                <div id="page-1" class="page"> <div class="page-content items-center"> <p class="lesson-text text-center leading-relaxed">Les consonnes nasales &lt;ᄂ, ᄆ, ᄋ&gt; sont prononcées aux mêmes points d’articulation que les consonnes basiques. Pourtant elles nécessitent d’abaisser le voile du palais pour faire passer l’air par les fosses nasales.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-0')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Titre</button> <button onclick="showPage('page-2')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-2" class="page"> <div class="page-content"> <button class="char-button" onclick="playSound('n')">ㄴ</button> <p class="lesson-text mt-8"><strong class="font-semibold text-blue-600">&lt;ᄂ&gt; (니은 ni-eun)</strong> est une consonne nasale alvéolaire.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-1')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-3')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-3" class="page"> <div class="page-content"> <div class="flex justify-center items-center gap-8"> <button class="char-button" onclick="playSound('n')">ㄴ</button> <button class="char-button" style="border-color: #6b7280; color: #4b5563; background-color: #f3f4f6;" onclick="playSound('d')">ㄷ</button> </div> <p class="lesson-text mt-8">Cette consonne se prononce au même point d’articulation que les autres sons alvéolaires comme &lt;ᄃ&gt;, &lt;ᄐ&gt;, ou &lt;ᄄ&gt;. Pourtant, pour prononcer &lt;ᄂ&gt;, il faut expirer l’air par les narines ainsi que par la bouche.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-2')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-4')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-4" class="page"> <div class="page-content combination-content"> <div class="flex flex-row flex-wrap justify-center items-center gap-x-4 gap-y-2"> <div class="flex flex-row items-center gap-x-4"> <button class="char-button" style="color: #3b82f6;" onclick="playSound('n')">ㄴ</button> <div class="symbol-text">+</div> <button class="char-button" style="color: #ef4444;" onclick="playSound('a')">ㅏ</button> </div> <div class="flex flex-row items-center gap-x-2"> <div class="symbol-text">=</div> <button class="char-button" style="color: #1f2937;" onclick="playSound('na')">나</button> </div> </div> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-3')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-5')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-5" class="page"> <div class="page-content"> <button class="char-button" onclick="playSound('m')">ㅁ</button> <p class="lesson-text mt-8"><strong class="font-semibold text-blue-600">&lt;ᄆ&gt; (미음 mi-eum)</strong> est une consonne nasale bilabiale.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-4')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-6')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-6" class="page"> <div class="page-content"> <div class="flex justify-center items-center gap-8"> <button class="char-button" onclick="playSound('m')">ㅁ</button> <button class="char-button" style="border-color: #6b7280; color: #4b5563; background-color: #f3f4f6;" onclick="playSound('b')">ㅂ</button> </div> <p class="lesson-text mt-8">Sa réalisation se fait au même point d’articulation que &lt;ᄇ&gt;, &lt;ᄑ&gt; ou &lt;ᄈ&gt;, sauf qu’il se prononce depuis les fosses nasales.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-5')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-7')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-7" class="page"> <div class="page-content combination-content"> <div class="flex flex-row flex-wrap justify-center items-center gap-x-4 gap-y-2"> <div class="flex flex-col items-center gap-y-2"> <button class="char-button" style="color: #3b82f6;" onclick="playSound('m')">ㅁ</button> <div class="symbol-text">+</div> <button class="char-button" style="color: #ef4444;" onclick="playSound('u')">ㅜ</button> </div> <div class="flex flex-row items-center gap-x-2"> <div class="symbol-text">=</div> <button class="char-button" style="color: #1f2937;" onclick="playSound('mu')">무</button> </div> </div> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-6')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-8')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-8" class="page"> <div class="page-content"> <button class="char-button">ㅇ</button> <p class="lesson-text mt-8">Comme déjà mentionné en chapitre 1, &lt;ᄋ&gt; en première position n’a aucune valeur phonétique et il est complètement muet.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-7')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-9')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-9" class="page"> <div class="page-content"> <button class="char-button" onclick="playSound('ng')">ㅇ</button> <p class="lesson-text mt-8">Cependant, quand il se place en position finale (au-dessous d’une syllabe complète), il se réalise comme une consonne nasale vélaire. Pour le prononcer correctement, montez le fond de la langue vers le voile du palais puis expirez l’air par les narines.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-8')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-10')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-10" class="page"> <div class="page-content"> <button class="char-button" onclick="playSound('ng')">ㅇ</button> <p class="lesson-text mt-8">En position finale, il se transcrit par /ŋ/ dans l’alphabet phonétique et correspond au son &lt;NG&gt; dans des mots d’origine anglaise comme &lt;parking&gt; ou &lt;camping&gt;. Pourtant, comme les francophones ont tendance à le prononcer comme &lt;ŋg&gt;, c’est plus facile de le comprendre comme &lt; ̃ &gt; en &lt;N&gt; finale comme &lt;Bon&gt; ou &lt;Pain&gt;.</p> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-9')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-11')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Suivant &rarr;</button> </div> </div>
                <div id="page-11" class="page"> <div class="page-content combination-content"> <div class="flex flex-row flex-wrap justify-center items-center gap-x-4 gap-y-2"> <div class="flex flex-col items-center gap-y-2"> <button class="char-button" style="color: #1f2937;" onclick="playSound('go')">고</button> <div class="symbol-text">+</div> <button class="char-button" style="color: #3b82f6;" onclick="playSound('ng')">ㅇ</button> </div> <div class="flex flex-row items-center gap-x-2"> <div class="symbol-text">=</div> <button class="char-button" style="color: #1f2937;" onclick="playSound('gong')">공</button> </div> </div> </div> <div class="flex justify-between items-center"> <button onclick="showPage('page-10')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button> <button onclick="showPage('page-12')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Faire le quiz &rarr;</button> </div> </div>
            `;
            
            quizData.forEach((data) => {
                const { id: quizNum, page, sound, options } = data;
                let contentHtml = `
                    <p class="quiz-question mb-4">Écoutez et choisissez la bonne écriture.</p> <!-- Modified text -->
                    <button class="audio-button" onclick="playSound('${sound}')"><svg class="audio-icon mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg></button>
                    <div id="quiz-${quizNum}-options" class="flex flex-wrap gap-2 justify-center">
                        ${Object.entries(options).map(([value, text]) => `<label class="quiz-option"><input type="radio" name="q${quizNum}" value="${text}">${text}</label>`).join('')}
                    </div>
                `;

                const prevButtonHtml = page === 12 ? `<button onclick="showPage('page-11')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Leçon</button>` : `<button onclick="showPage('page-${page - 1}')" class="nav-button text-gray-600 hover:bg-gray-200">&larr; Précédent</button>`;
                const navButtonHtml = `
                    <div id="quiz-${quizNum}-nav" class="flex justify-between items-center w-full">
                        ${prevButtonHtml}
                        <div class="flex items-center gap-4">
                           <div id="quiz-${quizNum}-feedback" class="feedback-area"></div>
                           <button onclick="checkAnswer(${quizNum})" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Valider</button>
                        </div>
                    </div>`;

                pagesHtml += `
                    <div id="page-${page}" class="page">
                        <div class="page-content">${contentHtml}</div>
                        ${navButtonHtml}
                    </div>
                `;
            });

            const completionPageHtml = `<div id="completion-page" class="page"> <div class="page-content"> <svg class="w-20 h-20 mx-auto mb-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <h2 class="title-text font-bold text-gray-800 mb-3">Chapitre terminé !</h2> <p class="lesson-text text-gray-600">Félicitations, vous avez terminé le chapitre.</p> </div> <div class="w-full text-center pb-4"> <button onclick="showPage('page-0')" class="nav-button bg-blue-600 text-white hover:bg-blue-700">Recommencer</button> </div> </div>`;
            container.innerHTML = pagesHtml + completionPageHtml;
        }

        function initializeApp() {
            createPages();
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    document.querySelectorAll(`input[name="${e.target.name}"]`).forEach(opt => opt.parentElement.classList.remove('selected'));
                    if(e.target.checked) e.target.parentElement.classList.add('selected');
                });
            });

            document.querySelectorAll('[id$="-nav"]').forEach(nav => {
                nav.dataset.initialHtml = nav.innerHTML;
            });
            
            showPage('page-0');
        }
        
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

